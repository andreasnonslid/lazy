<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Lazy Apps</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/png" href="icon.png" />
  <style>
    :root { color-scheme: dark; }
    * { box-sizing: border-box; }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: #05060a;
      color: #f5f5f5;
      display: flex;
      flex-direction: column;
    }

    /* Top navigation shell */
    .top-nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      background: #05060a;
      box-shadow: 0 1px 0 #111827;
      padding: 0.55rem 1rem;
      display: flex;
      justify-content: center;
    }

    .top-nav-inner {
      width: 100%;
      max-width: 960px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }

    .app-brand {
      display: flex;
      align-items: center;
      gap: 0rem;
      font-size: 0.85rem;
      font-weight: 600;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: #9ca3af;
      white-space: nowrap;
    }

    .app-brand img {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      display: block;
    }

    .tab-group {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.25rem;
      border-radius: 999px;
      background: #0b0c14;
      border: 1px solid #111827;
    }

    .tab-button {
      position: relative; /* needed for the notes dot */
      border: none;
      background: transparent;
      color: #e5e7eb;
      font-size: 0.85rem;
      padding: 0.3rem 0.9rem;
      border-radius: 999px;
      cursor: pointer;
      transition:
        background 0.12s ease,
        color 0.12s ease,
        transform 0.05s ease,
        border-color 0.12s ease;
      white-space: nowrap;
      border: 1px solid transparent;
    }

    .tab-button:hover {
      background: #111827;
    }

    .tab-button:active {
      transform: scale(0.96);
    }

    .tab-button.active {
      background: #2563eb;
      color: #f9fafb;
      border-color: #1d4ed8;
    }

    /* Alarm state for Timers tab */
    .tab-button.timer-alert {
      border-color: #ef4444;
      color: #fecaca;
    }

    .tab-button.timer-alert::after {
      content: " ðŸ””";
      font-size: 1rem;
      vertical-align: -0.1em;
    }

    /* Subtle dot for Notes reminders */
    .tab-button.notes-reminder::after {
      content: "";
      position: absolute;
      top: 4px;
      right: 4px;
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #f97373;
    }

    .tab-button:focus-visible {
      outline: 2px solid #38bdf8;
      outline-offset: 2px;
    }

    main {
      flex: 1 1 auto;
      margin-top: 3.1rem; /* space for fixed nav */
      padding: 0;
      min-height: 0;
    }

    /* One iframe per page, all full height; only .active is visible */
    .page-frame {
      width: 100%;
      height: 100%;
      border: none;
      background: #05060a;
      display: none;
    }

    .page-frame.active {
      display: block;
    }

    @media (max-width: 640px) {
      .top-nav-inner {
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

      .app-brand {
        font-size: 0.8rem;
      }
    }
  </style>
</head>
<body>
  <header class="top-nav">
    <div class="top-nav-inner">
      <div class="app-brand">
        <img src="icon.png" alt="Lazy Apps icon">
        <span>Lazy apps</span>
      </div>

      <div class="tab-group">
        <button class="tab-button" data-src="apps/timers.html">Timers</button>
        <button class="tab-button" data-src="apps/notes.html">Notes</button>
        <button class="tab-button" data-src="page3.html">Page 3</button>
      </div>
    </div>
  </header>

  <main>
    <!-- Each page has its own iframe, kept loaded all the time -->
    <iframe
      class="page-frame"
      data-src="apps/timers.html"
      src="apps/timers.html"
      title="Timers"
    ></iframe>

    <iframe
      class="page-frame"
      data-src="apps/notes.html"
      src="apps/notes.html"
      title="Notes"
    ></iframe>

    <iframe
      class="page-frame"
      data-src="page3.html"
      src="page3.html"
      title="Page 3"
    ></iframe>
  </main>

  <script>
    const LAST_PAGE_KEY = "lazy_last_page_v1";

    const buttons = Array.from(document.querySelectorAll(".tab-button"));
    const frames = Array.from(document.querySelectorAll(".page-frame"));

    function setActiveButton(clicked) {
      buttons.forEach(btn => {
        btn.classList.toggle("active", btn === clicked);
      });
    }

    function setActiveFrame(src) {
      frames.forEach(frame => {
        frame.classList.toggle("active", frame.dataset.src === src);
      });
    }

    function switchToButton(btn) {
      if (!btn) return;
      const src = btn.dataset.src;
      if (!src) return;

      setActiveButton(btn);
      setActiveFrame(src);

      try {
        localStorage.setItem(LAST_PAGE_KEY, src);
      } catch {
        // ignore storage errors
      }
    }

    // Click handling
    buttons.forEach(btn => {
      btn.addEventListener("click", () => {
        switchToButton(btn);
      });
    });

    // Restore last page on load
    let storedSrc = null;
    try {
      storedSrc = localStorage.getItem(LAST_PAGE_KEY);
    } catch {
      storedSrc = null;
    }

    const initialButton =
      buttons.find(btn => btn.dataset.src === storedSrc) ||
      buttons[0];

    switchToButton(initialButton);

    // Listen for alarm state messages from apps/timers.html AND reminder state from apps/notes.html
    window.addEventListener("message", event => {
      const data = event.data;
      if (!data || typeof data !== "object") return;

      // Timers: { source: "timers", type: "alarmState", anyFinished: boolean }
      if (data.source === "timers" && data.type === "alarmState") {
        const timersBtn = buttons.find(btn => btn.dataset.src === "apps/timers.html");
        if (!timersBtn) return;

        if (data.anyFinished) {
          timersBtn.classList.add("timer-alert");
        } else {
          timersBtn.classList.remove("timer-alert");
        }
        return;
      }

      // Notes: { type: "lazy_notes_reminder_state", hasDue: boolean }
      if (data.type === "lazy_notes_reminder_state") {
        const notesBtn = buttons.find(btn => btn.dataset.src === "apps/notes.html");
        if (!notesBtn) return;

        if (data.hasDue) {
          notesBtn.classList.add("notes-reminder");
        } else {
          notesBtn.classList.remove("notes-reminder");
        }
      }
    });
  </script>
</body>
</html>
